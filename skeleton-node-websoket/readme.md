# skeleton-node-websocket


[参考](http://qiita.com/ta9to/items/3cf49726b9636c8f0c0c)



## このrepoをcloneした場合

	$ npm install -d # dependenciesをinstall
	$ node app.js

で起動できる。




## ゼロから始める場合


### init & install
	npm init # package.json を作成
	npm install -g express
	npm install -g express-generator //CLI
	npm install --save ws

で、

	$ cd
	$ express --ejs ArtnightServer
	$ cd ArtnightServer
	$ npm install -d

### app.js

	var WebSocketServer = require('ws').Server
	var http = require('http')
	var express = require('express')
	var app = express()
	var port = process.env.PORT || 5000;


	app.use(express.static(__dirname + '/'));


	var server = http.createServer(app);
	server.listen(port);
	console.log('http server listening on %d', port);

	var wss = new WebSocketServer({server: server});
	console.log('websocket server created');

	wss.on('connection', function(ws)
	{
	    console.log('websocket connection open');

	    var id = setInterval(function()
	    {
	        ws.send(JSON.stringify(new Date()), function() {  });
	    }, 1000);

	    ws.on('close', function()
	    {
	        console.log('websocket connection close');
	        clearInterval(id);
	    });
	});

### index.html

	<html>
	  <head>
	    <style>
	      body {
	        font-family: "Helvetica Neue", helvetica, arial;
	        padding: 15px;
	      }

	      ul {
	        list-style: none;
	        margin: 0;
	        padding: 0;
	      }

	      ul li {
	        line-height: 1.4;
	      }
	    </style>

	    <script>
	      var host = location.origin.replace(/^http/, 'ws')
	      var ws = new WebSocket(host);
	      ws.onmessage = function (event) {
	        var li = document.createElement('li');
	        li.innerHTML = JSON.parse(event.data);
	        document.querySelector('#pings').appendChild(li);
	      };
	    </script>
	  </head>
	  <body>
	    <h1>Pings</h1>
	    <ul id='pings'></ul>
	  </body>
	</html>

### 起動

	$ node app.js # 起動

これで動く。

### gitignore

[https://github.com/github/gitignore/blob/master/Node.gitignore](https://github.com/github/gitignore/blob/master/Node.gitignore)


	# Logs
	logs
	*.log

	# Runtime data
	pids
	*.pid
	*.seed

	# Directory for instrumented libs generated by jscoverage/JSCover
	lib-cov

	# Coverage directory used by tools like istanbul
	coverage

	# Grunt intermediate storage (http://gruntjs.com/creating-plugins#storing-task-files)
	.grunt

	# node-waf configuration
	.lock-wscript

	# Compiled binary addons (http://nodejs.org/api/addons.html)
	build/Release

	# Dependency directory
	# https://www.npmjs.org/doc/misc/npm-faq.html#should-i-check-my-node_modules-folder-into-git
	node_modules
